<?php
session_start();
///////////////////////////////////////////////////////////////////////////////////////////////////////
//Connection à la base de données
///////////////////////////////////////////////////////////////////////////////////////////////////////
include('../../configuration/connect_db.php');
///////////////////////////////////////////////////////////////////////////////////////////////////////
//variable de redirection si un des champs est faux
///////////////////////////////////////////////////////////////////////////////////////////////////////
$redirect = false;
///////////////////////////////////////////////////////////////////////////////////////////////////////
//Test si le nom est vide
///////////////////////////////////////////////////////////////////////////////////////////////////////
if(isset($_POST['username'])){
  if(empty($_POST['username'])){
    $_SESSION['form_username'] = true;
    $redirect = true;
  }
  else{
    $_SESSION['form_username'] = false;
  }
}
else{
  $_SESSION['form_username'] = true;
  $redirect = true;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////
//Test si le nom est vide
///////////////////////////////////////////////////////////////////////////////////////////////////////
if(isset($_POST['email'])){
  if(empty($_POST['email'])){
    $_SESSION['form_email'] = true;
    $redirect = true;
  }
  else{
    $_SESSION['form_email'] = false;
  }
}
else{
  $_SESSION['form_email'] = true;
  $redirect = true;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////
//Test si le nom est vide
///////////////////////////////////////////////////////////////////////////////////////////////////////
if(isset($_POST['adresse'])){
  if(empty($_POST['adresse'])){
    $_SESSION['form_adresse'] = true;
    $redirect = true;
  }
  else{
    $_SESSION['form_adresse'] = false;
  }
}
else{
  $_SESSION['form_adresse'] = true;
  $redirect = true;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////
//Test si le password est vide
///////////////////////////////////////////////////////////////////////////////////////////////////////
if(isset($_POST['password'])){
  if(empty($_POST['password'])){
    $_SESSION['form_password'] = true;
    $redirect = true;
  }
  else{
    $_SESSION['form_password'] = false;
  }
}
else{
  $_SESSION['form_password'] = true;
  $redirect = true;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////
//Si un des champs est faux, je retourne sur la page de contact et inscris les champs faux
///////////////////////////////////////////////////////////////////////////////////////////////////////
if($redirect){
  header('Location: admin_create_user.php');
}
else{

  $admin = '';
  if(isset($_POST['admin'])){
    $admin = 'admin';
  }
///////////////////////////////////////////////////////////////////////////////////////////////////////
//insertion en base
///////////////////////////////////////////////////////////////////////////////////////////////////////
  $req = $bdd->prepare(
    'INSERT INTO users (username,name,surname,password,type,email,adresse,phone)'.
    'VALUES (:username, :name, :surname, :password, :type, :email, :adresse, :phone)'
    );

  $req->execute(array(
    'username' => htmlspecialchars($_POST['username']),
    'name' => htmlspecialchars($_POST['name']),
    'surname' => htmlspecialchars($_POST['surname']),
  	'password' => sha1(htmlspecialchars($_POST['password'])),
  	'type' => htmlspecialchars($admin),
    'email' => htmlspecialchars($_POST['email']),
    'adresse' => htmlspecialchars($_POST['adresse']),
    'phone' => htmlspecialchars($_POST['phone']),
  	));

}
header('Location: admin_managment_user.php');
?>
